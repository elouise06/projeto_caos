<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Meu Perfil</title>
    <link rel="stylesheet" href="{{url_for('static', filename='css/perfil_usuario.css')}}">
</head>

<body>

    <div class="page">

        <aside class="sidebar">
            <div class="user">
                <div class="user-icon"></div>
                <span>{{ usuario.nome_usuario }}</span>
            </div>

            <div class="menu-title">Minha conta</div>

            <button class="menu-item active" data-section="perfil">Perfil</button>
            <button class="menu-item" data-section="senha">senha/trocar senha</button>
            <button class="menu-item" data-section="contribuicoes">Minhas contribuições</button>

            <a href="{{ url_for('logout') }}" class="menu-item sair">Sair</a>

        </aside>


        <main class="content">


            <section id="perfil" class="section active">
                <h2>Meu perfil</h2>
                <p class="subtitle">Gerenciar e proteger sua conta</p>
                <hr>

                <div class="profile-box">
                    <div class="profile-left">
                        <form method="POST">
                            <label>Nome de usuário</label>
                            <input type="text" name="nome_usuario" value="{{ usuario.nome_usuario }}">

                            <label>Nome</label>
                            <input type="text" name="nome" value="{{ usuario.nome }}">
                            <div class="pnome">
                                <p>Nome do usuário pode ser alterado apenas uma vez.</p>
                            </div>

                            <label>Email</label>
                            <input type="email" name="email" value="{{ usuario.email }}">

                            <label>Telefone</label>
                            <input type="text" name="telefone" value="{{ usuario.telefone }}">

                            <button type="submit" class="save-btn">Salvar</button>
                        </form>
                        <form method="POST" action="{{ url_for('deletar_usuario') }}"
                            onsubmit="return confirm('Tem certeza que deseja deletar sua conta?');">
                            <button type="submit" class="delete-btn">Deletar Conta</button>
                        </form>

                    </div>

                    <div class="profile-right">
                        <div class="avatar"></div>
                        <button class="img-btn">Selecionar imagem</button>
                        <p style="font-size:12px;color:#666;">
                            Tamanho máx. 1MB<br>JPEG, PNG
                        </p>
                    </div>
                </div>
            </section>

            <section id="senha" class="section">
                <h2>Senha/trocar senha</h2>
                <p class="subtitle">Gerenciar e proteger sua conta</p>
                <hr>

                <div class="password-box">
                    <form method="POST" action="{{ url_for('alterar_senha') }}">
                        <label>Senha atual</label>
                        <div class="password-field">
                            <input type="password" name="senha_atual" id="senhaAtual" placeholder="********">
                            <img src="img/olho-vermelho.png" id="toggleSenha" class="eye-icon" alt="Mostrar senha">
                        </div>

                        <label>Nova senha</label>
                        <input type="password" name="nova_senha" placeholder="Digite aqui">

                        <div class="dadosver">
                            <h2>Dados para verificação</h2>
                            <p>Email: {{ usuario.email }}</p>
                            <p>Número de telefone: {{ usuario.telefone }}</p>
                        </div>

                        <div class="save-btn2">
                            <button type="submit">Alterar senha</button>
                        </div>
                    </form>
                </div>
            </section>


            <section id="contribuicoes" class="section">
                <h2>Minhas contribuições</h2>
                <p class="subtitle">Visualizar suas movimentações de livros</p>
                <hr>

                <div class="table">
                    <div class="table-header">
                        <div class="col-title">Título do livro</div>
                        <div class="col-value">Autor</div>
                        <div class="col-type">Valor</div>
                    </div>
                        {% for livro in livros %}
                        <div class="table-row">
                            <div class="col-title">{{ livro.titulo }}</div>
                            <div class="col-value">{{ livro.autor }}</div>
                            <div class="col-type">{{ livro.valor_desejado or '0,00' }}</div>

                            <div class="col-actions">
                                <form method="POST" action="{{ url_for('deletar_livro', id=livro.id) }}"
                                    onsubmit="return confirm('Deseja realmente deletar este livro?');">
                                    <button type="submit" class="delete-btn">Excluir</button>
                                </form>

                                <a href="{{ url_for('editar_livro', id=livro.id) }}" class="edit-btn">
                                    Editar
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                </div>
            </section>

        </main>
    </div>


    <script>

        const menuItems = document.querySelectorAll('.menu-item[data-section]');
        const sections = document.querySelectorAll('.section');

        menuItems.forEach(item => {
            item.addEventListener('click', () => {
                menuItems.forEach(i => i.classList.remove('active'));
                sections.forEach(s => s.classList.remove('active'));

                item.classList.add('active');
                const id = item.getAttribute('data-section');
                document.getElementById(id).classList.add('active');
            });
        });


        const senhaInput = document.getElementById('senhaAtual');
        const toggleSenha = document.getElementById('toggleSenha');

        toggleSenha.addEventListener('click', () => {
            if (senhaInput.type === 'password') {
                senhaInput.type = 'text';
                toggleSenha.src = 'img/olho-aberto.png';
            } else {
                senhaInput.type = 'password';
                toggleSenha.src = 'img/olho-vermelho.png';
            }
        });
    </script>

</body>

</html>